<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>TriAce 2026 ‚Äì Tournament Scorecard</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        :root{
          --bg1:#667eea; --bg2:#764ba2; --ink:#1a202c; --muted:#718096; --card:#ffffff;
          --ring:#e2e8f0; --accent:#22d3ee; --groupA:#10b981; --groupB:#f59e0b;
        }
        html,body{ height:100%; }
        body{
          font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial,sans-serif;
          background:linear-gradient(135deg,var(--bg1),var(--bg2));
          min-height:100vh; color:var(--ink);
        }
        .header{ position:sticky; top:0; z-index:50; backdrop-filter:blur(10px); }
        .header-bar{
          display:flex; align-items:center; justify-content:space-between;
          max-width:1400px; margin:0 auto; padding:.75rem 1rem;
          background:rgba(255,255,255,.95); box-shadow:0 2px 8px rgba(0,0,0,.08);
        }
        .brand{ display:flex; align-items:center; gap:.5rem; }
        .brand i{ font-size:1.8rem; }
        .brand strong{
          font-size:1.25rem; background:linear-gradient(135deg,var(--bg1),var(--bg2));
          -webkit-background-clip:text; background-clip:text; -webkit-text-fill-color:transparent;
          font-weight:900;
        }
        
        .menu-btn{display:none;border:0;background:transparent;font-size:1.5rem;padding:.25rem .5rem;cursor:pointer;}
        
        /* MAIN NAVIGATION */
        nav.nav{
          max-width:1400px;margin:.35rem auto 0;display:flex;gap:.5rem;padding:.5rem 1rem;
          background:rgba(255,255,255,.95);border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,.08);
          flex-wrap: wrap;
          justify-content: center;
        }
        .nav a, .nav .nav-tab{
          text-decoration:none;color:#4a5568;font-weight:600;
          padding:.65rem 1.2rem;border-radius:8px;white-space:nowrap;
          cursor: pointer;
          transition: all 0.2s ease;
          font-size: .95rem;
          border: 2px solid transparent;
          display: inline-flex;
          align-items: center;
          gap: .4rem;
        }
        .nav a:hover, .nav .nav-tab:hover{
          background:rgba(102,126,234,0.1);
          border-color: rgba(102,126,234,0.3);
        }
        .nav a[aria-current="page"], .nav .nav-tab.active{
          color:#fff;
          background:linear-gradient(135deg,var(--bg1),var(--bg2));
          border-color: transparent;
        }
        
        .container{ max-width:1400px; margin:1rem auto 2rem; padding:0 1rem; }
        .card{
          background:#fff; border-radius:12px; padding:1.25rem 1.5rem; margin-bottom:1rem;
          box-shadow:0 4px 12px rgba(0,0,0,.1);
        }
        .card h2{ margin-bottom:1rem; display:flex; align-items:center; gap:.5rem; }
        .group-badge{
          display:inline-block; padding:.25rem .75rem; border-radius:20px; font-size:.85rem;
          font-weight:700; color:#fff;
        }
        .group-badge.a{ background:linear-gradient(135deg,#10b981,#059669); }
        .group-badge.b{ background:linear-gradient(135deg,#f59e0b,#d97706); }
        .groups-container{ display:grid; grid-template-columns:1fr 1fr; gap:1rem; }
        .team-list{ margin-bottom:1rem; }
        .team-item{
          display:flex; justify-content:space-between; align-items:center;
          padding:.75rem 1rem; border-bottom:1px solid var(--ring);
        }
        .team-item:last-child{ border-bottom:none; }
        .team-item:hover{ background:#f8fafc; }
        .team-name{ font-weight:700; }
        .team-members{ font-size:.85rem; color:var(--muted); }
        .table-container{ overflow-x:auto; }
        table{ width:100%; border-collapse:collapse; background:#fff; border-radius:8px; overflow:hidden; }
        thead th{
          background:linear-gradient(135deg,#0f172a,#1e293b); color:#fff; padding:.75rem .5rem; text-align:center; font-size:.8rem;
        }
        tbody td{ padding:.6rem .5rem; border-bottom:1px solid var(--ring); text-align:center; font-size:.85rem; }
        tbody tr:hover{ background:#f8fafc; }
        .standings-table tr.qualified{ background:linear-gradient(90deg,#d1fae5 0%, transparent 100%); }
        .rank-cell{ font-weight:900; }
        .team-cell{ font-weight:700; text-align:left !important; padding-left:1rem !important; }
        .points-cell{ font-weight:900; color:#667eea; }
        .hint{ color:var(--muted); font-size:.85rem; margin-top:.5rem; }
        .access-card{ border:2px solid var(--accent); text-align:center; }
        .access-controls{ display:flex; gap:.6rem; justify-content:center; align-items:center; flex-wrap:wrap; }
        .access-input{
          padding:.7rem 1rem; border:2px solid var(--ring); border-radius:8px; min-width:240px;
        }
        .access-input:focus{ outline:none; border-color:var(--accent); }
        .btn{
          padding:.7rem 1.2rem; border:none; border-radius:8px; font-weight:700; color:#fff; cursor:pointer;
          background:linear-gradient(135deg,var(--bg1),var(--bg2)); box-shadow:0 2px 10px rgba(102,126,234,.35);
        }
        .btn:hover{ opacity:.9; }
        .btn.success{ background:linear-gradient(135deg,#10b981,#059669); }
        .btn.secondary{ background:#64748b; box-shadow:none; }
        .btn.ghost{ background:#fff; color:#1f2937; border:2px solid var(--ring); box-shadow:none; }
        .scoring-card{ border:2px solid var(--accent); background:linear-gradient(135deg,#f8fafc 0%,#f1f5f9 100%); }
        .card-header{ display:flex; justify-content:space-between; align-items:center; gap:.75rem; flex-wrap:wrap; }
        .tools{ display:flex; gap:.5rem; flex-wrap:wrap; }
        .parser-section{ margin-top:1rem; }
        .parser-textarea{
          width:100%; min-height:200px; padding:1rem; border:2px solid var(--ring); border-radius:8px;
          font-family:monospace; font-size:.9rem; line-height:1.6; resize:vertical;
        }
        .parser-textarea:focus{ outline:none; border-color:var(--accent); }
        .preview-section{ margin-top:1rem; padding:1rem; background:#f8fafc; border-radius:8px; border:1px solid var(--ring); }
        .preview-section h3{ margin-bottom:.75rem; font-size:1rem; }
        .preview-item{ padding:.5rem .75rem; margin-bottom:.5rem; background:#fff; border-radius:6px; border-left:3px solid var(--accent); font-size:.9rem; }
        .preview-item.error{ border-left-color:#ef4444; background:#fef2f2; color:#991b1b; }
        .preview-item.valid{ border-left-color:#10b981; }
        .preview-item.total{ border-left-color:#667eea; background:#d1fae5; font-weight:700; }
        .preview-empty{ color:var(--muted); font-style:italic; }
        .format-help{ margin-top:1rem; padding:1rem; background:#ecfeff; border-radius:8px; border:1px solid #a5f3fc; }
        .format-help h4{ margin-bottom:.5rem; color:#0e7490; font-size:.9rem; }
        .format-help pre{ font-size:.8rem; color:#155e75; white-space:pre-wrap; line-height:1.5; }
        .form-actions{ display:flex; gap:.6rem; justify-content:center; flex-wrap:wrap; margin-top:1rem; }
        .hidden{ display:none; }
        .tab-content{ display:none; }
        .tab-content.active{ display:block; }
        .team-badge{ display:inline-block; padding:.15rem .5rem; border-radius:4px; font-size:.7rem; font-weight:700; color:#fff; background:var(--bg1); margin-left:.5rem; }
        
        @media (max-width: 768px){
          .groups-container{ grid-template-columns:1fr; }
          thead th{ font-size:.7rem; padding:.5rem .35rem; }
          tbody td{ font-size:.75rem; padding:.5rem .35rem; }
        }
    </style>
</head>
<body>
<div class="header">
    <div class="header-bar">
        <div class="brand">
            <strong>üèÜ TriAce 2026</strong>
        </div>
        <button id="menuBtn" class="menu-btn">‚ò∞</button>
    </div>
    <nav class="nav" id="siteNav">
        <a href="index.html">üè† Home</a>
        <a href="rules.html">üìã Rules</a>
        <a href="schedule.html">üìÖ Schedule A</a>
        <a href="schedule-b.html">üìÖ Schedule B</a>
        <a href="standings.html" aria-current="page">üìä Standings</a>
        <a href="scoring.html">üìù Score Entry</a>
        <a href="history.html">üìú History</a>
        <a href="teams.html">üë• Teams</a>
    </nav>
</div>

<div class="container">
    <div class="card">
        <h2>üèÜ Group Standings</h2>
        <div class="groups-container">
            <div>
                <h3 style="margin-bottom:.75rem;"><span class="group-badge a">Group A</span></h3>
                <div class="table-container">
                    <table class="standings-table">
                        <thead>
                        <tr>
                            <th>#</th><th>Team</th><th>M</th><th>W</th><th>L</th>
                            <th>GF</th><th>GA</th><th>+/-</th><th>Pts</th>
                        </tr>
                        </thead>
                        <tbody id="standingsBodyA"></tbody>
                    </table>
                </div>
            </div>
            <div>
                <h3 style="margin-bottom:.75rem;"><span class="group-badge b">Group B</span></h3>
                <div class="table-container">
                    <table class="standings-table">
                        <thead>
                        <tr>
                            <th>#</th><th>Team</th><th>M</th><th>W</th><th>L</th>
                            <th>GF</th><th>GA</th><th>+/-</th><th>Pts</th>
                        </tr>
                        </thead>
                        <tbody id="standingsBodyB"></tbody>
                    </table>
                </div>
            </div>
        </div>
        <p class="hint">‚ú® Top 3 from each group qualify | M: Matches, W: Wins, L: Losses, GF: Games For, GA: Games Against, Pts: Points (3 per win)</p>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script>
    const firebaseConfig = {
        apiKey: "AIzaSyDbO0eP52i4t3V94bEiDcl7WoKbSrrM9VA",
        authDomain: "koc2-20fb8.firebaseapp.com",
        databaseURL: "https://koc2-20fb8-default-rtdb.firebaseio.com",
        projectId: "koc2-20fb8",
        storageBucket: "koc2-20fb8.firebasestorage.app",
        messagingSenderId: "317734341461",
        appId: "1:317734341461:web:1bcad5a1792fac0e46bddc"
    };

    const firebaseApp = firebase.initializeApp(firebaseConfig);
    const auth = firebaseApp.auth();
    const database = firebaseApp.database();
    const matchesRef = database.ref('TriAceDB');

    let authReady = false;
    function ensureAuth(){
      if(authReady) return Promise.resolve();
      return auth.signInAnonymously().then(() => { authReady = true; });
    }
    ensureAuth().catch(err => console.error('Auth failed', err));

    let matches = [];
    let matchesLoaded = false;
    let currentTeam = null;
    
    const standingsBodyA = document.getElementById('standingsBodyA');
    const standingsBodyB = document.getElementById('standingsBodyB');
    
    const TEAM_MAP = new Map([
        ['Team A1', { name: 'Team A1', abbreviation: 'A1', players: ['Yogesh', 'Dinkar', 'Sudarshan'], group: 'A' }],
        ['Team A2', { name: 'Team A2', abbreviation: 'A2', players: ['Prashant', 'Vinoth', 'Vamsi'], group: 'A' }],
        ['Team A3', { name: 'Team A3', abbreviation: 'A3', players: ['Sudhakar', 'Dinesh', 'Uma'], group: 'A' }],
        ['Team A4', { name: 'Team A4', abbreviation: 'A4', players: ['Sandeep G', 'Damu', 'Vidhya Sagar'], group: 'A' }],
        ['Team A5', { name: 'Team A5', abbreviation: 'A5', players: ['Hari', 'Ram', 'Satish'], group: 'A' }],
        ['Team A6', { name: 'Team A6', abbreviation: 'A6', players: ['Nagarjuna', 'Mohan', 'Ganesh'], group: 'A' }],
        ['Team A7', { name: 'Team A7', abbreviation: 'A7', players: ['Sreekanth B', 'Uday P', 'Sashi R'], group: 'A' }],
        ['Team A8', { name: 'Team A8', abbreviation: 'A8', players: ['Mayur Patel', 'Chandrakant', 'Pardeep K'], group: 'A' }],
        ['Team A9', { name: 'Team A9', abbreviation: 'A9', players: ['Harsha S', 'Vijay V', 'Kartha V'], group: 'A' }],
        ['Team B1', { name: 'Team B1', abbreviation: 'B1', players: ['Manish', 'Biju', 'Ritesh'], group: 'B' }],
        ['Team B2', { name: 'Team B2', abbreviation: 'B2', players: ['Kalyan', 'Sandeep', 'Uday'], group: 'B' }],
        ['Team B3', { name: 'Team B3', abbreviation: 'B3', players: ['Kails', 'Veeresh', 'Vivek Reddy'], group: 'B' }],
        ['Team B4', { name: 'Team B4', abbreviation: 'B4', players: ['Venky DH', 'Kalam', 'Vasu'], group: 'B' }],
        ['Team B5', { name: 'Team B5', abbreviation: 'B5', players: ['Narayan P', 'Ratnesh', 'Jay S'], group: 'B' }],
        ['Team B6', { name: 'Team B6', abbreviation: 'B6', players: ['Vinod A', 'Raj K', 'Krishna'], group: 'B' }],
        ['Team B7', { name: 'Team B7', abbreviation: 'B7', players: ['Srikanth', 'Bharat', 'Sridhar'], group: 'B' }],
        ['Team B8', { name: 'Team B8', abbreviation: 'B8', players: ['Mahi', 'Shivaji', 'Vikas'], group: 'B' }],
        ['Team B9', { name: 'Team B9', abbreviation: 'B9', players: ['Chandu M', 'Dinesh K', 'Malla'], group: 'B' }]
    ]);

    const TEAM_LOOKUP = TEAM_MAP;
    const TEAMS_A = ['Team A1', 'Team A2', 'Team A3', 'Team A4', 'Team A5', 'Team A6', 'Team A7', 'Team A8', 'Team A9'];
    const TEAMS_B = ['Team B1', 'Team B2', 'Team B3', 'Team B4', 'Team B5', 'Team B6', 'Team B7', 'Team B8', 'Team B9'];
    
    const groupA = Array.from(TEAM_MAP.values()).filter(t => t.group === 'A');
    const groupB = Array.from(TEAM_MAP.values()).filter(t => t.group === 'B');

    async function guardWriteAccess(){
      try { await ensureAuth(); return true; }
      catch(err){ alert('‚ùå Auth failed.'); return false; }
    }

    function upgradeMatch(m){
      if(!m || !m.t1 || !m.t2 || !m.win) return null;
      const g1 = Number(m.g1), g2 = Number(m.g2);
      if(!Number.isFinite(g1) || !Number.isFinite(g2)) return null;
      const upgraded = { t1:m.t1, t2:m.t2, g1, g2, win:m.win, ts:Number(m.ts)||Date.now(), s1:Number(m.s1)||0, s2:Number(m.s2)||0 };
      if(Array.isArray(m.lines)) upgraded.lines = m.lines;
      return upgraded;
    }

    function renderAll(){
      renderStandings();
    }

    function handleSnapshot(snapshot){
      const data = snapshot.val(), list = [];
      if(data){ for(const [id, entry] of Object.entries(data)){ const u = upgradeMatch(entry); if(u){ u.id = id; list.push(u); } } }
      matches = list.sort((a,b)=>b.ts - a.ts);
      matchesLoaded = true;
      renderAll();
    }
    matchesRef.on('value', handleSnapshot, err => { console.error('Firebase error', err); matches = []; matchesLoaded = true; renderAll(); });


    function computeStandings(teamNames){
      const stats = {};
      teamNames.forEach(n => stats[n] = { team:n, matches:0, wins:0, losses:0, gamesFor:0, gamesAgainst:0, points:0 });
      for(const m of matches){
        if(!stats[m.t1] || !stats[m.t2]) continue;
        stats[m.t1].matches++; stats[m.t2].matches++;
        stats[m.t1].gamesFor += m.g1; stats[m.t1].gamesAgainst += m.g2;
        stats[m.t2].gamesFor += m.g2; stats[m.t2].gamesAgainst += m.g1;
        if(m.win === m.t1){ stats[m.t1].wins++; stats[m.t2].losses++; stats[m.t1].points += 3; }
        else if(m.win === m.t2){ stats[m.t2].wins++; stats[m.t1].losses++; stats[m.t2].points += 3; }
      }
      Object.values(stats).forEach(s => { s.gameDiff = s.gamesFor - s.gamesAgainst; });
      return Object.values(stats).sort((a,b)=> (b.points-a.points)||(b.gameDiff-a.gameDiff)||(b.gamesFor-a.gamesFor)||a.team.localeCompare(b.team));
    }

    function renderStandings(){
      if(!matchesLoaded){ standingsBodyA.innerHTML = standingsBodyB.innerHTML = '<tr><td colspan="9" style="text-align:center;">Loading...</td></tr>'; return; }
      [['A', TEAMS_A, standingsBodyA], ['B', TEAMS_B, standingsBodyB]].forEach(([g, teams, tbody]) => {
        const rows = computeStandings(teams);
        tbody.innerHTML = rows.map((r,i)=>{
          const team = TEAM_LOOKUP.get(r.team);
          const players = team ? team.players.join('/') : '';
          return `<tr class="${i<3?'qualified':''}">
            <td class="rank-cell" data-label="#">${i+1}</td>
            <td class="team-cell" data-label="Team">${team?.abbreviation||r.team}<br><small style="font-weight:400;color:var(--muted);font-size:.7rem;">${players}</small></td>
            <td data-label="M">${r.matches}</td><td data-label="W">${r.wins}</td><td data-label="L">${r.losses}</td>
            <td data-label="GF">${r.gamesFor}</td><td data-label="GA">${r.gamesAgainst}</td>
            <td data-label="+/-">${r.gameDiff > 0 ? '+' : ''}${r.gameDiff}</td>
            <td class="points-cell" data-label="Pts">${r.points}</td></tr>`;
        }).join('');
      });
    }

    renderStandings();

    // Mobile menu toggle
    document.getElementById('menuBtn').addEventListener('click',()=>{
      document.getElementById('siteNav').classList.toggle('open');
    });
</script>
</body>
</html>

